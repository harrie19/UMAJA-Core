<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMAJA - United Multipurpose Autonomous JavaScript Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .chat-container {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        .bot-message {
            background: white;
            color: #333;
            align-self: flex-start;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #userInput {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-card p {
            opacity: 0.9;
            line-height: 1.6;
        }

        .typing-indicator {
            display: none;
            padding: 15px;
            background: white;
            border-radius: 18px;
            max-width: 70px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-indicator span {
            height: 10px;
            width: 10px;
            background: #667eea;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #c62828;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 1em;
            }

            .content {
                padding: 20px;
            }

            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¤– UMAJA</h1>
            <p>United Multipurpose Autonomous JavaScript Agent</p>
        </div>

        <div class="content">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting...</span>
            </div>

            <div id="errorContainer"></div>

            <div class="chat-container" id="chatContainer">
                <div class="bot-message">
                    Hello! I'm UMAJA, your AI assistant. How can I help you today?
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="input-container">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Type your message here..." 
                    disabled
                />
                <button class="btn btn-primary" id="sendBtn" disabled>
                    Send
                </button>
            </div>

            <div class="features">
                <div class="feature-card">
                    <h3>ðŸ§  Intelligent</h3>
                    <p>Powered by advanced AI to understand and respond to your needs</p>
                </div>
                <div class="feature-card">
                    <h3>âš¡ Fast</h3>
                    <p>Quick responses and efficient processing of your requests</p>
                </div>
                <div class="feature-card">
                    <h3>ðŸ”’ Secure</h3>
                    <p>Your conversations are private and handled with care</p>
                </div>
                <div class="feature-card">
                    <h3>ðŸŽ¯ Versatile</h3>
                    <p>From coding to creativity, I can help with various tasks</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const BACKEND_URL = 'https://web-production-6ec45.up.railway.app';
        const FALLBACK_MODE = false;
        let conversationHistory = [];

        // DOM Elements
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const errorContainer = document.getElementById('errorContainer');

        // Initialize
        async function init() {
            try {
                const response = await fetch(`${BACKEND_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    setStatus('connected', 'Connected');
                    enableInput();
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                console.error('Connection error:', error);
                if (FALLBACK_MODE) {
                    setStatus('connected', 'Connected (Fallback Mode)');
                    enableInput();
                } else {
                    setStatus('error', 'Connection Failed');
                    showError('Unable to connect to backend. Please try again later.');
                }
            }
        }

        function setStatus(status, text) {
            statusText.textContent = text;
            if (status === 'connected') {
                statusDot.classList.remove('error');
            } else if (status === 'error') {
                statusDot.classList.add('error');
            }
        }

        function enableInput() {
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }

        function showError(message) {
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
            messageDiv.textContent = content;
            
            // Insert before typing indicator
            chatContainer.insertBefore(messageDiv, typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTyping() {
            typingIndicator.classList.add('active');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.classList.remove('active');
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            conversationHistory.push({ role: 'user', content: message });
            
            // Clear input
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            // Show typing indicator
            showTyping();

            try {
                if (FALLBACK_MODE) {
                    // Fallback response
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    const response = getFallbackResponse(message);
                    hideTyping();
                    addMessage(response);
                    conversationHistory.push({ role: 'assistant', content: response });
                } else {
                    // Real backend call
                    const response = await fetch(`${BACKEND_URL}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            history: conversationHistory
                        }),
                    });

                    hideTyping();

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    addMessage(data.response);
                    conversationHistory.push({ role: 'assistant', content: data.response });
                }
            } catch (error) {
                console.error('Error:', error);
                hideTyping();
                addMessage('Sorry, I encountered an error processing your request. Please try again.');
                showError('Failed to send message. Please check your connection.');
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        function getFallbackResponse(message) {
            const responses = [
                "I'm currently running in fallback mode. Your message has been received!",
                "Thank you for your message. The backend is temporarily unavailable, but I'm here to assist you.",
                "I appreciate your patience. While I can't access full features right now, I'm happy to help where I can.",
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Event Listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !userInput.disabled) {
                sendMessage();
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
name: ðŸ¥½ Reality Check Monitor

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:  # Manual trigger
  push:
    paths:
      - 'src/**'
      - 'api/**'
      - 'docs/config.js'

permissions:
  contents: read
  issues: write

jobs:
  reality-check:
    name: Run Reality Agent
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ðŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ðŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || echo "Some dependencies may be optional"
      
      - name: ðŸ¥½ Run Reality Agent
        id: reality-check
        run: |
          python src/reality_agent.py
        continue-on-error: true
      
      - name: ðŸ“Š Display Summary
        run: |
          echo "## ðŸ¥½ Reality Check Results" >> $GITHUB_STEP_SUMMARY
          if [ -f data/reality_checks/*.md ]; then
            cat $(ls -t data/reality_checks/*.md | head -1) >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: ðŸ“¤ Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: reality-check-results-${{ github.run_number }}
          path: data/reality_checks/
          retention-days: 30
      
      - name: ðŸš¨ Create Issue on Critical Status
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ðŸš¨ Critical Issues Detected by Reality Agent',
              body: `Reality Agent detected critical issues at ${new Date().toISOString()}.\n\nCheck the [workflow run](${context.payload.repository.html_url}/actions/runs/${context.runId}) for details.`,
              labels: ['bug', 'reality-check', 'automated']
            });

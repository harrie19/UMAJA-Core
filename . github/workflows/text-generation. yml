name: UMAJA Text Generation

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'Topic for reflection generation'
        required: true
        default: 'artificial intelligence'
        type: string
      length: 
        description: 'Text length'
        required: true
        default: 'short'
        type: choice
        options:
          - short
          - long
      noise_level:
        description: 'Noise level (0.0 = deterministic, 1.0 = chaos)'
        required: true
        default: '0.5'
        type: string

jobs:
  generate-text:
    runs-on:  ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run:  |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸ¨ Generate and analyze text
        run: |
          python << 'PYTHON_SCRIPT'
          import sys
          sys.path.insert(0, '.')
          from src.rauschen_generator import RauschenGenerator
          from src.vektor_analyzer import VektorAnalyzer
          
          print("="*70)
          print("ğŸ§  UMAJA-CORE TEXT GENERATION")
          print("="*70)
          print()
          
          topic = "${{ github.event.inputs.topic }}"
          length = "${{ github. event.inputs.length }}"
          noise_level = float("${{ github.event.inputs. noise_level }}")
          
          print(f"ğŸ“‹ Configuration:")
          print(f"   Topic: {topic}")
          print(f"   Length: {length}")
          print(f"   Noise Level: {noise_level}")
          print()
          
          print("ğŸ¨ Generating text...")
          generator = RauschenGenerator()
          result = generator.generate_reflection(topic, length, noise_level)
          print("âœ… Generation complete!")
          print()
          
          print("ğŸ” Analyzing quality...")
          analyzer = VektorAnalyzer()
          analysis = analyzer.analyze_coherence(result['text'], topic)
          print("âœ… Analysis complete!")
          print()
          
          print("="*70)
          print("ğŸ“„ GENERATED TEXT")
          print("="*70)
          print()
          print(result['text'])
          print()
          
          print("="*70)
          print("ğŸ“Š METADATA")
          print("="*70)
          print(f"ğŸ†” Text ID: {result['text_id']}")
          print(f"ğŸ“ Word Count: {result['word_count']}")
          print(f"ğŸ’° Price: ${result['price']}")
          print(f"ğŸ•’ Timestamp: {result['timestamp']}")
          print()
          
          print("="*70)
          print("ğŸ¯ QUALITY ANALYSIS")
          print("="*70)
          print(f"ğŸ¨ Theme Similarity: {analysis['theme_similarity']:.3f}")
          print(f"ğŸ”— Coherence:  {analysis['avg_inter_sentence_coherence']:.3f}")
          print(f"â­ Overall Score: {analysis['overall_score']:.3f}")
          print(f"ğŸ† Quality:  {analysis['quality']. upper()}")
          print()
          PYTHON_SCRIPT
      
      - name: ğŸ’¾ Save output as artifact
        run: |
          mkdir -p outputs
          python << 'PYTHON_SCRIPT'
          import sys
          sys.path.insert(0, '.')
          from src.rauschen_generator import RauschenGenerator
          import json
          
          topic = "${{ github.event.inputs.topic }}"
          length = "${{ github.event.inputs. length }}"
          noise_level = float("${{ github.event.inputs.noise_level }}")
          
          generator = RauschenGenerator()
          result = generator.generate_reflection(topic, length, noise_level)
          
          with open('outputs/generated_text.txt', 'w') as f:
              f.write(result['text'])
          
          with open('outputs/metadata.json', 'w') as f:
              json.dump(result, f, indent=2, default=str)
          
          print("âœ… Output saved to outputs/")
          PYTHON_SCRIPT
      
      - name: ğŸ“¤ Upload generated text
        uses: actions/upload-artifact@v4
        with:
          name: umaja-generated-text
          path: outputs/
          retention-days: 30 i8
